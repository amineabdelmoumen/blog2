---
title: "Data persistence with docker containers"
date: 2021-12 -09T01:00:32+01:00


categories: [docker,Containers]
tags: [docker,volumes]
toc: false
author: "amine abdelmoumen"
---

When we are working on a stateless application we do not need any data persistence so when the container stops our data will disapear .
But this is not always the case usually we need data persistency so when we stop the container the data remains . so let's see how we can achieve the data persistency with docker container.\
There are three ways of persisting data in the docker world bind,volumes,tmpfs .remember what we are trying to do is store data which we gonna use inside the container in some file in the host machine.\
# bind mount : 
   When you use a bind mount, a file or directory on the host machine is mounted into a container. The file or directory is referenced by its full path on the host machine.The file or directory does not need to exist on the Docker host already ,It is created on demand if it does not yet exist. Bind mounts are very performant, but they rely on the host machine’s filesystem having a specific directory structure available
![boundMount](/bindMount.png)
a little bit of practice 

 ```
 docker run -d \
  -it \
  --name devtest \
  --mount type=bind,source="$(pwd)"/target,target=/app \
   redis:latest
 ```
 
 ```--name ```: naming the container \
 ```--mount``` :flag for specifying the mount informations:\
    ```type``` is using to specifie the type of mounting we want to use ,here we are using bind mount ```type=bind``` \
    ```source``` For bind mounts, this is the path to the file or directory on the Docker daemon host. May be specified as ```source``` or ```src```.\
 ```target```: destination takes as its value the path where the file or directory is mounted in the container. May be specified as ```destination```, ```dst```, or ```target``` .


# tmpfs mount :
When you create a container with a tmpfs mount, the container can create files outside the container’s writable layer.\

As opposed to volumes and bind mounts, a tmpfs mount is temporary, and only persisted in the host memory. When the container stops, the tmpfs mount is removed, and files written there won’t be persisted.
 ![tmpfs](/tmpfs.png)
 This is useful to temporarily store sensitive files that you don’t want to persist in either the host or the container writable layer.

**Limitations of the tmpfs mount :**
    Unlike volumes and bind mounts, you can’t share tmpfs mounts between containers.\
    This functionality is only available if you’re running Docker on Linux.
 
## Use a tmpfs mount in a container
To use a ```tmpfs``` mount in a container, use the ```--tmpfs``` flag, or use the ```--mount``` flag with ```type=tmpfs``` and ```destination``` options. There is no ```source``` for tmpfs mounts. The following example creates a tmpfs mount at ```/app``` in a Nginx container. The first example uses the --mount flag and the second uses the ```--tmpfs``` flag.
 ```
 docker run -d \
  -it \
  --name tmptest \
  --mount type=tmpfs,destination=/app \
  nginx:latest
  ```
  Verify that the mount is a tmpfs mount by running ```docker container inspect tmptest ```and looking for the Mounts section
  ```
  "Tmpfs": {
    "/app": ""
},
```

# Volumes:
> Volumes are the preferred mechanism for persisting data generated by and used by Docker containers. While bind mounts are dependent on the directory structure and OS of the host machine, volumes are completely managed by Docker. Volumes have several advantages over bind mounts:.

1. Volumes are easier to back up or migrate than bind mounts.
2. You can manage volumes using Docker CLI commands or the Docker API.
3. Volumes work on both Linux and Windows containers.
4. Volumes can be more safely shared among multiple containers.
5. Volume drivers let you store volumes on remote hosts or cloud providers, 6. to encrypt the contents of volumes, or to add other functionality.
7. New volumes can have their content pre-populated by a container.
8. Volumes on Docker Desktop have much higher performance than bind mounts  from Mac and Windows hosts.

